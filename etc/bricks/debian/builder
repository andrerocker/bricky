#!/bin/bash -e

. $BRICKS_HOME/suexec
chown -R builder. /builded

debian() {
  info 'Starting buildpackage'
  pushd /opt/workspace/source
    dpkg-buildpackage -b -rfakeroot
  popd

  info 'Moving deb files to volume'
  mv /opt/workspace/*.deb /opt/workspace/*.changes  /builded/
  echo "Builded package available on: $BRICKS_DEBIAN_OUTPUT_PACKAGE_PATH"
}

suexec debian
